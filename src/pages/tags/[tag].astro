---
// This page is a page for each post that contains a certain tag.
import PostList from "$components/Posts/PostList.svelte";
import ProjectList from "$components/Projects/ProjectList.svelte";
import Tag from "$components/Tag.svelte";
import RootLayout from "$layouts/RootLayout.astro";
import { getBlogPosts, getProjects } from "$lib/collections";

// 1. Generate a new path for every collection entry
export async function getStaticPaths() {
	const blogPosts = await getBlogPosts();
	const projects = await getProjects();

	let tags = blogPosts.map((entry) => entry.data.tags).flat();
	tags.concat(projects.map((entry) => entry.data.tags).flat());
	tags = [...new Set(tags)];

	return tags.map((tag) => {
		return {
			params: { tag },
			props: {
				posts: blogPosts.filter((entry) => entry.data.tags.includes(tag)),
				projects: projects.filter((entry) => entry.data.tags.includes(tag))
			}
		};
	});
}

// 2. When it's time to render, you can get the entry directly from the prop
const {
	params: { tag },
	props: { posts, projects }
} = Astro;
---

<RootLayout
	title={`Tag: ${tag}`}
	description={`The #${tag} tag listing for all posts with this tag`}
>
	<h1>Tag: <Tag tag={tag || ""} /></h1>

	{
		posts.length > 0 ? (
			<>
				<h2>Posts</h2>
				<PostList {posts} />
			</>
		) : null
	}

	{
		projects.length > 0 ? (
			<>
				<h2>Projects</h2>
				<ProjectList {projects} />
			</>
		) : null
	}
</RootLayout>
